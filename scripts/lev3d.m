clear
tic
P=21;
Q=165;
dc=30/1000;
% a=0.05;%длина 
% b=0.05; %толщина
% c=0.05;%высота
m=0;
n=0;
q=0;%///////////////
q1=0;
q3=0;
dn=0.005; %//////////
I0=1;
qm=gpuArray(0);
ni=6e24;
ne=8e24;
Te=2973;
T=Te*11604.525;
ZZ = linspace(-10, 10, 1000);
[M,N] = (meshgrid(ZZ)); %////////
M = gpuArray(M);
N = gpuArray(N);
It=gpuArray(zeros(size(M)));

 La=0.18504e-7;
 [nn,nq]=size(qm);
 t0=1.61; %//////////////
 t1=t0+0.03; 
 ph=1; %//////////////////
z = (linspace(t0,t1,ph)) ;
 [nn1,nq1]=size(z);
 a=0.1;
 c=0.4;
b=0.8;
t=1.51;
 N(N==0)=realmin;
 M(M==0)=realmin;
   for t=z 
 a = 206.14*t.^4 - 472.28*t.^3 + 189.1*t.^2 - 197.08*t + 432.49;
a = a/100;
 c=(-dc+(dc^2+4*a.^2).^(1/2))/2;
 b=c+dc;
%        ae =1.838e+25; 
%        be =1.665  ;
%        ce =0.0718  ;
% ne =  ae*exp(-((t-be)/ce)^2);       
%        at =3284;  
%        bt =1.7;  
%        ct =0.1796;
% T=at*exp(-((t-bt)/ct)^2);
%       
%        ai = 5.229e+24  ;
%        bi=1.668  ;
%        ci =0.1112;  
% ni =  ai*exp(-((t-bi)/ci)^2);
% 
%     a1=1.451e+04 ; 
%     b1=(t1+t0)/2  ;
%     c1=0.01175;       
% I0 =  a1*exp(-((t-b1)/c1)^2);
l1 =4.1e-23*ni*ne./(T^(7/2)*((6.62e-27*2.997e10)./(La*1.38e-16*T)).^3);
l2=6.65*10^-25*ne;
Lq=1./((l1+l2))*10;
for m = qm
 for n = qm
l = - 2*(a.^4.*b.^4.*c.^4.*(M - m).^2.*(4.*((cos(q3).*(cos(q).*(P + Q - n) + sin(q).*(M - m)) + sin(q3).*(sin(q1).*(sin(q).*(P + Q - n) - cos(q).*(M - m)) + cos(q1).*(N - n))).^2./a.^2 + (sin(q3).*(cos(q).*(P + Q - n) + sin(q).*(M - m)) - cos(q3).*(sin(q1).*(sin(q).*(P + Q - n) - cos(q).*(M - m)) + cos(q1).*(N - n))).^2./c.^2 + (cos(q1).*(sin(q).*(P + Q - n) - cos(q).*(M - m)) - sin(q1).*(N - n)).^2./b.^2).*((cos(q3).*(n.*cos(q) - P.*cos(q) + m.*sin(q)) + sin(q3).*(n.*cos(q1) - P.*sin(q).*sin(q1) - m.*cos(q).*sin(q1) + n.*sin(q).*sin(q1))).^2./a.^2 + (sin(q3).*(n.*cos(q) - P.*cos(q) + m.*sin(q)) - cos(q3).*(n.*cos(q1) - P.*sin(q).*sin(q1) - m.*cos(q).*sin(q1) + n.*sin(q).*sin(q1))).^2./c.^2 + (n.*sin(q1) + P.*cos(q1).*sin(q) + m.*cos(q).*cos(q1) - n.*cos(q1).*sin(q)).^2./b.^2 - 1) - ((2.*(cos(q3).*(cos(q).*(P + Q - n) + sin(q).*(M - m)) + sin(q3).*(sin(q1).*(sin(q).*(P + Q - n) - cos(q).*(M - m)) + cos(q1).*(N - n))).*(cos(q3).*(n.*cos(q) - P.*cos(q) + m.*sin(q)) + sin(q3).*(n.*cos(q1) - P.*sin(q).*sin(q1) - m.*cos(q).*sin(q1) + n.*sin(q).*sin(q1))))./a.^2 - (2.*(cos(q1).*(sin(q).*(P + Q - n) - cos(q).*(M - m)) - sin(q1).*(N - n)).*(n.*sin(q1) + P.*cos(q1).*sin(q) + m.*cos(q).*cos(q1) - n.*cos(q1).*sin(q)))./b.^2 + (2.*(sin(q3).*(cos(q).*(P + Q - n) + sin(q).*(M - m)) - cos(q3).*(sin(q1).*(sin(q).*(P + Q - n) - cos(q).*(M - m)) + cos(q1).*(N - n))).*(sin(q3).*(n.*cos(q) - P.*cos(q) + m.*sin(q)) - cos(q3).*(n.*cos(q1) - P.*sin(q).*sin(q1) - m.*cos(q).*sin(q1) + n.*sin(q).*sin(q1))))./c.^2).^2))./(M.^2.*a.^2.*b.^2.*cos(q).^2.*cos(q3).^2.*sin(q1).^2 + 2.*M.^2.*a.^2.*b.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + M.^2.*a.^2.*b.^2.*sin(q).^2.*sin(q3).^2 + M.^2.*a.^2.*c.^2.*cos(q).^2.*cos(q1).^2 + M.^2.*b.^2.*c.^2.*cos(q).^2.*sin(q1).^2.*sin(q3).^2 - 2.*M.^2.*b.^2.*c.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + M.^2.*b.^2.*c.^2.*cos(q3).^2.*sin(q).^2 - 2.*M.*N.*a.^2.*b.^2.*cos(q).*cos(q1).*cos(q3).^2.*sin(q1) - 2.*M.*N.*a.^2.*b.^2.*cos(q1).*cos(q3).*sin(q).*sin(q3) + 2.*M.*N.*a.^2.*c.^2.*cos(q).*cos(q1).*sin(q1) - 2.*M.*N.*b.^2.*c.^2.*cos(q).*cos(q1).*sin(q1).*sin(q3).^2 + 2.*M.*N.*b.^2.*c.^2.*cos(q1).*cos(q3).*sin(q).*sin(q3) + 2.*M.*P.*a.^2.*b.^2.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) - 2.*M.*P.*a.^2.*b.^2.*cos(q).*cos(q3).^2.*sin(q).*sin(q1).^2 + 2.*M.*P.*a.^2.*b.^2.*cos(q).*sin(q).*sin(q3).^2 - 2.*M.*P.*a.^2.*b.^2.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*M.*P.*a.^2.*c.^2.*cos(q).*cos(q1).^2.*sin(q) - 2.*M.*P.*b.^2.*c.^2.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) + 2.*M.*P.*b.^2.*c.^2.*cos(q).*cos(q3).^2.*sin(q) - 2.*M.*P.*b.^2.*c.^2.*cos(q).*sin(q).*sin(q1).^2.*sin(q3).^2 + 2.*M.*P.*b.^2.*c.^2.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) + 2.*M.*Q.*a.^2.*b.^2.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) - 2.*M.*Q.*a.^2.*b.^2.*cos(q).*cos(q3).^2.*sin(q).*sin(q1).^2 + 2.*M.*Q.*a.^2.*b.^2.*cos(q).*sin(q).*sin(q3).^2 - 2.*M.*Q.*a.^2.*b.^2.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*M.*Q.*a.^2.*c.^2.*cos(q).*cos(q1).^2.*sin(q) - 2.*M.*Q.*b.^2.*c.^2.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) + 2.*M.*Q.*b.^2.*c.^2.*cos(q).*cos(q3).^2.*sin(q) - 2.*M.*Q.*b.^2.*c.^2.*cos(q).*sin(q).*sin(q1).^2.*sin(q3).^2 + 2.*M.*Q.*b.^2.*c.^2.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*M.*a.^2.*b.^2.*m.*cos(q).^2.*cos(q3).^2.*sin(q1).^2 - 4.*M.*a.^2.*b.^2.*m.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) - 2.*M.*a.^2.*b.^2.*m.*sin(q).^2.*sin(q3).^2 - 2.*M.*a.^2.*b.^2.*n.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) + 2.*M.*a.^2.*b.^2.*n.*cos(q).*cos(q1).*cos(q3).^2.*sin(q1) + 2.*M.*a.^2.*b.^2.*n.*cos(q).*cos(q3).^2.*sin(q).*sin(q1).^2 - 2.*M.*a.^2.*b.^2.*n.*cos(q).*sin(q).*sin(q3).^2 + 2.*M.*a.^2.*b.^2.*n.*cos(q1).*cos(q3).*sin(q).*sin(q3) + 2.*M.*a.^2.*b.^2.*n.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*M.*a.^2.*c.^2.*m.*cos(q).^2.*cos(q1).^2 + 2.*M.*a.^2.*c.^2.*n.*cos(q).*cos(q1).^2.*sin(q) - 2.*M.*a.^2.*c.^2.*n.*cos(q).*cos(q1).*sin(q1) - 2.*M.*b.^2.*c.^2.*m.*cos(q).^2.*sin(q1).^2.*sin(q3).^2 + 4.*M.*b.^2.*c.^2.*m.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) - 2.*M.*b.^2.*c.^2.*m.*cos(q3).^2.*sin(q).^2 + 2.*M.*b.^2.*c.^2.*n.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) + 2.*M.*b.^2.*c.^2.*n.*cos(q).*cos(q1).*sin(q1).*sin(q3).^2 - 2.*M.*b.^2.*c.^2.*n.*cos(q).*cos(q3).^2.*sin(q) + 2.*M.*b.^2.*c.^2.*n.*cos(q).*sin(q).*sin(q1).^2.*sin(q3).^2 - 2.*M.*b.^2.*c.^2.*n.*cos(q1).*cos(q3).*sin(q).*sin(q3) - 2.*M.*b.^2.*c.^2.*n.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) + N.^2.*a.^2.*b.^2.*cos(q1).^2.*cos(q3).^2 + N.^2.*a.^2.*c.^2.*sin(q1).^2 + N.^2.*b.^2.*c.^2.*cos(q1).^2.*sin(q3).^2 - 2.*N.*P.*a.^2.*b.^2.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 2.*N.*P.*a.^2.*b.^2.*cos(q1).*cos(q3).^2.*sin(q).*sin(q1) - 2.*N.*P.*a.^2.*c.^2.*cos(q1).*sin(q).*sin(q1) + 2.*N.*P.*b.^2.*c.^2.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 2.*N.*P.*b.^2.*c.^2.*cos(q1).*sin(q).*sin(q1).*sin(q3).^2 - 2.*N.*Q.*a.^2.*b.^2.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 2.*N.*Q.*a.^2.*b.^2.*cos(q1).*cos(q3).^2.*sin(q).*sin(q1) - 2.*N.*Q.*a.^2.*c.^2.*cos(q1).*sin(q).*sin(q1) + 2.*N.*Q.*b.^2.*c.^2.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 2.*N.*Q.*b.^2.*c.^2.*cos(q1).*sin(q).*sin(q1).*sin(q3).^2 + 2.*N.*a.^2.*b.^2.*m.*cos(q).*cos(q1).*cos(q3).^2.*sin(q1) + 2.*N.*a.^2.*b.^2.*m.*cos(q1).*cos(q3).*sin(q).*sin(q3) + 2.*N.*a.^2.*b.^2.*n.*cos(q).*cos(q1).*cos(q3).*sin(q3) - 2.*N.*a.^2.*b.^2.*n.*cos(q1).^2.*cos(q3).^2 - 2.*N.*a.^2.*b.^2.*n.*cos(q1).*cos(q3).^2.*sin(q).*sin(q1) - 2.*N.*a.^2.*c.^2.*m.*cos(q).*cos(q1).*sin(q1) + 2.*N.*a.^2.*c.^2.*n.*cos(q1).*sin(q).*sin(q1) - 2.*N.*a.^2.*c.^2.*n.*sin(q1).^2 + 2.*N.*b.^2.*c.^2.*m.*cos(q).*cos(q1).*sin(q1).*sin(q3).^2 - 2.*N.*b.^2.*c.^2.*m.*cos(q1).*cos(q3).*sin(q).*sin(q3) - 2.*N.*b.^2.*c.^2.*n.*cos(q).*cos(q1).*cos(q3).*sin(q3) - 2.*N.*b.^2.*c.^2.*n.*cos(q1).^2.*sin(q3).^2 - 2.*N.*b.^2.*c.^2.*n.*cos(q1).*sin(q).*sin(q1).*sin(q3).^2 + P.^2.*a.^2.*b.^2.*cos(q).^2.*sin(q3).^2 - 2.*P.^2.*a.^2.*b.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + P.^2.*a.^2.*b.^2.*cos(q3).^2.*sin(q).^2.*sin(q1).^2 + P.^2.*a.^2.*c.^2.*cos(q1).^2.*sin(q).^2 + P.^2.*b.^2.*c.^2.*cos(q).^2.*cos(q3).^2 + 2.*P.^2.*b.^2.*c.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + P.^2.*b.^2.*c.^2.*sin(q).^2.*sin(q1).^2.*sin(q3).^2 + 2.*P.*Q.*a.^2.*b.^2.*cos(q).^2.*sin(q3).^2 - 4.*P.*Q.*a.^2.*b.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + 2.*P.*Q.*a.^2.*b.^2.*cos(q3).^2.*sin(q).^2.*sin(q1).^2 + 2.*P.*Q.*a.^2.*c.^2.*cos(q1).^2.*sin(q).^2 + 2.*P.*Q.*b.^2.*c.^2.*cos(q).^2.*cos(q3).^2 + 4.*P.*Q.*b.^2.*c.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + 2.*P.*Q.*b.^2.*c.^2.*sin(q).^2.*sin(q1).^2.*sin(q3).^2 - 2.*P.*a.^2.*b.^2.*m.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) + 2.*P.*a.^2.*b.^2.*m.*cos(q).*cos(q3).^2.*sin(q).*sin(q1).^2 - 2.*P.*a.^2.*b.^2.*m.*cos(q).*sin(q).*sin(q3).^2 + 2.*P.*a.^2.*b.^2.*m.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*P.*a.^2.*b.^2.*n.*cos(q).^2.*sin(q3).^2 + 2.*P.*a.^2.*b.^2.*n.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 4.*P.*a.^2.*b.^2.*n.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) - 2.*P.*a.^2.*b.^2.*n.*cos(q1).*cos(q3).^2.*sin(q).*sin(q1) - 2.*P.*a.^2.*b.^2.*n.*cos(q3).^2.*sin(q).^2.*sin(q1).^2 + 2.*P.*a.^2.*c.^2.*m.*cos(q).*cos(q1).^2.*sin(q) - 2.*P.*a.^2.*c.^2.*n.*cos(q1).^2.*sin(q).^2 + 2.*P.*a.^2.*c.^2.*n.*cos(q1).*sin(q).*sin(q1) + 2.*P.*b.^2.*c.^2.*m.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) - 2.*P.*b.^2.*c.^2.*m.*cos(q).*cos(q3).^2.*sin(q) + 2.*P.*b.^2.*c.^2.*m.*cos(q).*sin(q).*sin(q1).^2.*sin(q3).^2 - 2.*P.*b.^2.*c.^2.*m.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*P.*b.^2.*c.^2.*n.*cos(q).^2.*cos(q3).^2 - 2.*P.*b.^2.*c.^2.*n.*cos(q).*cos(q1).*cos(q3).*sin(q3) - 4.*P.*b.^2.*c.^2.*n.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) - 2.*P.*b.^2.*c.^2.*n.*cos(q1).*sin(q).*sin(q1).*sin(q3).^2 - 2.*P.*b.^2.*c.^2.*n.*sin(q).^2.*sin(q1).^2.*sin(q3).^2 + Q.^2.*a.^2.*b.^2.*cos(q).^2.*sin(q3).^2 - 2.*Q.^2.*a.^2.*b.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + Q.^2.*a.^2.*b.^2.*cos(q3).^2.*sin(q).^2.*sin(q1).^2 + Q.^2.*a.^2.*c.^2.*cos(q1).^2.*sin(q).^2 + Q.^2.*b.^2.*c.^2.*cos(q).^2.*cos(q3).^2 + 2.*Q.^2.*b.^2.*c.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + Q.^2.*b.^2.*c.^2.*sin(q).^2.*sin(q1).^2.*sin(q3).^2 - 2.*Q.*a.^2.*b.^2.*m.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) + 2.*Q.*a.^2.*b.^2.*m.*cos(q).*cos(q3).^2.*sin(q).*sin(q1).^2 - 2.*Q.*a.^2.*b.^2.*m.*cos(q).*sin(q).*sin(q3).^2 + 2.*Q.*a.^2.*b.^2.*m.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*Q.*a.^2.*b.^2.*n.*cos(q).^2.*sin(q3).^2 + 2.*Q.*a.^2.*b.^2.*n.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 4.*Q.*a.^2.*b.^2.*n.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) - 2.*Q.*a.^2.*b.^2.*n.*cos(q1).*cos(q3).^2.*sin(q).*sin(q1) - 2.*Q.*a.^2.*b.^2.*n.*cos(q3).^2.*sin(q).^2.*sin(q1).^2 + 2.*Q.*a.^2.*c.^2.*m.*cos(q).*cos(q1).^2.*sin(q) - 2.*Q.*a.^2.*c.^2.*n.*cos(q1).^2.*sin(q).^2 + 2.*Q.*a.^2.*c.^2.*n.*cos(q1).*sin(q).*sin(q1) + 2.*Q.*b.^2.*c.^2.*m.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) - 2.*Q.*b.^2.*c.^2.*m.*cos(q).*cos(q3).^2.*sin(q) + 2.*Q.*b.^2.*c.^2.*m.*cos(q).*sin(q).*sin(q1).^2.*sin(q3).^2 - 2.*Q.*b.^2.*c.^2.*m.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*Q.*b.^2.*c.^2.*n.*cos(q).^2.*cos(q3).^2 - 2.*Q.*b.^2.*c.^2.*n.*cos(q).*cos(q1).*cos(q3).*sin(q3) - 4.*Q.*b.^2.*c.^2.*n.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) - 2.*Q.*b.^2.*c.^2.*n.*cos(q1).*sin(q).*sin(q1).*sin(q3).^2 - 2.*Q.*b.^2.*c.^2.*n.*sin(q).^2.*sin(q1).^2.*sin(q3).^2 + a.^2.*b.^2.*m.^2.*cos(q).^2.*cos(q3).^2.*sin(q1).^2 + 2.*a.^2.*b.^2.*m.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + a.^2.*b.^2.*m.^2.*sin(q).^2.*sin(q3).^2 + 2.*a.^2.*b.^2.*m.*n.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) - 2.*a.^2.*b.^2.*m.*n.*cos(q).*cos(q1).*cos(q3).^2.*sin(q1) - 2.*a.^2.*b.^2.*m.*n.*cos(q).*cos(q3).^2.*sin(q).*sin(q1).^2 + 2.*a.^2.*b.^2.*m.*n.*cos(q).*sin(q).*sin(q3).^2 - 2.*a.^2.*b.^2.*m.*n.*cos(q1).*cos(q3).*sin(q).*sin(q3) - 2.*a.^2.*b.^2.*m.*n.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) + a.^2.*b.^2.*n.^2.*cos(q).^2.*sin(q3).^2 - 2.*a.^2.*b.^2.*n.^2.*cos(q).*cos(q1).*cos(q3).*sin(q3) - 2.*a.^2.*b.^2.*n.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + a.^2.*b.^2.*n.^2.*cos(q1).^2.*cos(q3).^2 + 2.*a.^2.*b.^2.*n.^2.*cos(q1).*cos(q3).^2.*sin(q).*sin(q1) + a.^2.*b.^2.*n.^2.*cos(q3).^2.*sin(q).^2.*sin(q1).^2 + a.^2.*c.^2.*m.^2.*cos(q).^2.*cos(q1).^2 - 2.*a.^2.*c.^2.*m.*n.*cos(q).*cos(q1).^2.*sin(q) + 2.*a.^2.*c.^2.*m.*n.*cos(q).*cos(q1).*sin(q1) + a.^2.*c.^2.*n.^2.*cos(q1).^2.*sin(q).^2 - 2.*a.^2.*c.^2.*n.^2.*cos(q1).*sin(q).*sin(q1) + a.^2.*c.^2.*n.^2.*sin(q1).^2 + b.^2.*c.^2.*m.^2.*cos(q).^2.*sin(q1).^2.*sin(q3).^2 - 2.*b.^2.*c.^2.*m.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + b.^2.*c.^2.*m.^2.*cos(q3).^2.*sin(q).^2 - 2.*b.^2.*c.^2.*m.*n.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) - 2.*b.^2.*c.^2.*m.*n.*cos(q).*cos(q1).*sin(q1).*sin(q3).^2 + 2.*b.^2.*c.^2.*m.*n.*cos(q).*cos(q3).^2.*sin(q) - 2.*b.^2.*c.^2.*m.*n.*cos(q).*sin(q).*sin(q1).^2.*sin(q3).^2 + 2.*b.^2.*c.^2.*m.*n.*cos(q1).*cos(q3).*sin(q).*sin(q3) + 2.*b.^2.*c.^2.*m.*n.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) + b.^2.*c.^2.*n.^2.*cos(q).^2.*cos(q3).^2 + 2.*b.^2.*c.^2.*n.^2.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 2.*b.^2.*c.^2.*n.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + b.^2.*c.^2.*n.^2.*cos(q1).^2.*sin(q3).^2 + 2.*b.^2.*c.^2.*n.^2.*cos(q1).*sin(q).*sin(q1).*sin(q3).^2 + b.^2.*c.^2.*n.^2.*sin(q).^2.*sin(q1).^2.*sin(q3).^2).^2 - (a.^4.*b.^4.*c.^4.*(N - n).^2.*(4.*((cos(q3).*(cos(q).*(P + Q - n) + sin(q).*(M - m)) + sin(q3).*(sin(q1).*(sin(q).*(P + Q - n) - cos(q).*(M - m)) + cos(q1).*(N - n))).^2./a.^2 + (sin(q3).*(cos(q).*(P + Q - n) + sin(q).*(M - m)) - cos(q3).*(sin(q1).*(sin(q).*(P + Q - n) - cos(q).*(M - m)) + cos(q1).*(N - n))).^2./c.^2 + (cos(q1).*(sin(q).*(P + Q - n) - cos(q).*(M - m)) - sin(q1).*(N - n)).^2./b.^2).*((cos(q3).*(n.*cos(q) - P.*cos(q) + m.*sin(q)) + sin(q3).*(n.*cos(q1) - P.*sin(q).*sin(q1) - m.*cos(q).*sin(q1) + n.*sin(q).*sin(q1))).^2./a.^2 + (sin(q3).*(n.*cos(q) - P.*cos(q) + m.*sin(q)) - cos(q3).*(n.*cos(q1) - P.*sin(q).*sin(q1) - m.*cos(q).*sin(q1) + n.*sin(q).*sin(q1))).^2./c.^2 + (n.*sin(q1) + P.*cos(q1).*sin(q) + m.*cos(q).*cos(q1) - n.*cos(q1).*sin(q)).^2./b.^2 - 1) - ((2.*(cos(q3).*(cos(q).*(P + Q - n) + sin(q).*(M - m)) + sin(q3).*(sin(q1).*(sin(q).*(P + Q - n) - cos(q).*(M - m)) + cos(q1).*(N - n))).*(cos(q3).*(n.*cos(q) - P.*cos(q) + m.*sin(q)) + sin(q3).*(n.*cos(q1) - P.*sin(q).*sin(q1) - m.*cos(q).*sin(q1) + n.*sin(q).*sin(q1))))./a.^2 - (2.*(cos(q1).*(sin(q).*(P + Q - n) - cos(q).*(M - m)) - sin(q1).*(N - n)).*(n.*sin(q1) + P.*cos(q1).*sin(q) + m.*cos(q).*cos(q1) - n.*cos(q1).*sin(q)))./b.^2 + (2.*(sin(q3).*(cos(q).*(P + Q - n) + sin(q).*(M - m)) - cos(q3).*(sin(q1).*(sin(q).*(P + Q - n) - cos(q).*(M - m)) + cos(q1).*(N - n))).*(sin(q3).*(n.*cos(q) - P.*cos(q) + m.*sin(q)) - cos(q3).*(n.*cos(q1) - P.*sin(q).*sin(q1) - m.*cos(q).*sin(q1) + n.*sin(q).*sin(q1))))./c.^2).^2))./(M.^2.*a.^2.*b.^2.*cos(q).^2.*cos(q3).^2.*sin(q1).^2 + 2.*M.^2.*a.^2.*b.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + M.^2.*a.^2.*b.^2.*sin(q).^2.*sin(q3).^2 + M.^2.*a.^2.*c.^2.*cos(q).^2.*cos(q1).^2 + M.^2.*b.^2.*c.^2.*cos(q).^2.*sin(q1).^2.*sin(q3).^2 - 2.*M.^2.*b.^2.*c.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + M.^2.*b.^2.*c.^2.*cos(q3).^2.*sin(q).^2 - 2.*M.*N.*a.^2.*b.^2.*cos(q).*cos(q1).*cos(q3).^2.*sin(q1) - 2.*M.*N.*a.^2.*b.^2.*cos(q1).*cos(q3).*sin(q).*sin(q3) + 2.*M.*N.*a.^2.*c.^2.*cos(q).*cos(q1).*sin(q1) - 2.*M.*N.*b.^2.*c.^2.*cos(q).*cos(q1).*sin(q1).*sin(q3).^2 + 2.*M.*N.*b.^2.*c.^2.*cos(q1).*cos(q3).*sin(q).*sin(q3) + 2.*M.*P.*a.^2.*b.^2.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) - 2.*M.*P.*a.^2.*b.^2.*cos(q).*cos(q3).^2.*sin(q).*sin(q1).^2 + 2.*M.*P.*a.^2.*b.^2.*cos(q).*sin(q).*sin(q3).^2 - 2.*M.*P.*a.^2.*b.^2.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*M.*P.*a.^2.*c.^2.*cos(q).*cos(q1).^2.*sin(q) - 2.*M.*P.*b.^2.*c.^2.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) + 2.*M.*P.*b.^2.*c.^2.*cos(q).*cos(q3).^2.*sin(q) - 2.*M.*P.*b.^2.*c.^2.*cos(q).*sin(q).*sin(q1).^2.*sin(q3).^2 + 2.*M.*P.*b.^2.*c.^2.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) + 2.*M.*Q.*a.^2.*b.^2.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) - 2.*M.*Q.*a.^2.*b.^2.*cos(q).*cos(q3).^2.*sin(q).*sin(q1).^2 + 2.*M.*Q.*a.^2.*b.^2.*cos(q).*sin(q).*sin(q3).^2 - 2.*M.*Q.*a.^2.*b.^2.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*M.*Q.*a.^2.*c.^2.*cos(q).*cos(q1).^2.*sin(q) - 2.*M.*Q.*b.^2.*c.^2.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) + 2.*M.*Q.*b.^2.*c.^2.*cos(q).*cos(q3).^2.*sin(q) - 2.*M.*Q.*b.^2.*c.^2.*cos(q).*sin(q).*sin(q1).^2.*sin(q3).^2 + 2.*M.*Q.*b.^2.*c.^2.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*M.*a.^2.*b.^2.*m.*cos(q).^2.*cos(q3).^2.*sin(q1).^2 - 4.*M.*a.^2.*b.^2.*m.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) - 2.*M.*a.^2.*b.^2.*m.*sin(q).^2.*sin(q3).^2 - 2.*M.*a.^2.*b.^2.*n.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) + 2.*M.*a.^2.*b.^2.*n.*cos(q).*cos(q1).*cos(q3).^2.*sin(q1) + 2.*M.*a.^2.*b.^2.*n.*cos(q).*cos(q3).^2.*sin(q).*sin(q1).^2 - 2.*M.*a.^2.*b.^2.*n.*cos(q).*sin(q).*sin(q3).^2 + 2.*M.*a.^2.*b.^2.*n.*cos(q1).*cos(q3).*sin(q).*sin(q3) + 2.*M.*a.^2.*b.^2.*n.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*M.*a.^2.*c.^2.*m.*cos(q).^2.*cos(q1).^2 + 2.*M.*a.^2.*c.^2.*n.*cos(q).*cos(q1).^2.*sin(q) - 2.*M.*a.^2.*c.^2.*n.*cos(q).*cos(q1).*sin(q1) - 2.*M.*b.^2.*c.^2.*m.*cos(q).^2.*sin(q1).^2.*sin(q3).^2 + 4.*M.*b.^2.*c.^2.*m.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) - 2.*M.*b.^2.*c.^2.*m.*cos(q3).^2.*sin(q).^2 + 2.*M.*b.^2.*c.^2.*n.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) + 2.*M.*b.^2.*c.^2.*n.*cos(q).*cos(q1).*sin(q1).*sin(q3).^2 - 2.*M.*b.^2.*c.^2.*n.*cos(q).*cos(q3).^2.*sin(q) + 2.*M.*b.^2.*c.^2.*n.*cos(q).*sin(q).*sin(q1).^2.*sin(q3).^2 - 2.*M.*b.^2.*c.^2.*n.*cos(q1).*cos(q3).*sin(q).*sin(q3) - 2.*M.*b.^2.*c.^2.*n.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) + N.^2.*a.^2.*b.^2.*cos(q1).^2.*cos(q3).^2 + N.^2.*a.^2.*c.^2.*sin(q1).^2 + N.^2.*b.^2.*c.^2.*cos(q1).^2.*sin(q3).^2 - 2.*N.*P.*a.^2.*b.^2.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 2.*N.*P.*a.^2.*b.^2.*cos(q1).*cos(q3).^2.*sin(q).*sin(q1) - 2.*N.*P.*a.^2.*c.^2.*cos(q1).*sin(q).*sin(q1) + 2.*N.*P.*b.^2.*c.^2.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 2.*N.*P.*b.^2.*c.^2.*cos(q1).*sin(q).*sin(q1).*sin(q3).^2 - 2.*N.*Q.*a.^2.*b.^2.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 2.*N.*Q.*a.^2.*b.^2.*cos(q1).*cos(q3).^2.*sin(q).*sin(q1) - 2.*N.*Q.*a.^2.*c.^2.*cos(q1).*sin(q).*sin(q1) + 2.*N.*Q.*b.^2.*c.^2.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 2.*N.*Q.*b.^2.*c.^2.*cos(q1).*sin(q).*sin(q1).*sin(q3).^2 + 2.*N.*a.^2.*b.^2.*m.*cos(q).*cos(q1).*cos(q3).^2.*sin(q1) + 2.*N.*a.^2.*b.^2.*m.*cos(q1).*cos(q3).*sin(q).*sin(q3) + 2.*N.*a.^2.*b.^2.*n.*cos(q).*cos(q1).*cos(q3).*sin(q3) - 2.*N.*a.^2.*b.^2.*n.*cos(q1).^2.*cos(q3).^2 - 2.*N.*a.^2.*b.^2.*n.*cos(q1).*cos(q3).^2.*sin(q).*sin(q1) - 2.*N.*a.^2.*c.^2.*m.*cos(q).*cos(q1).*sin(q1) + 2.*N.*a.^2.*c.^2.*n.*cos(q1).*sin(q).*sin(q1) - 2.*N.*a.^2.*c.^2.*n.*sin(q1).^2 + 2.*N.*b.^2.*c.^2.*m.*cos(q).*cos(q1).*sin(q1).*sin(q3).^2 - 2.*N.*b.^2.*c.^2.*m.*cos(q1).*cos(q3).*sin(q).*sin(q3) - 2.*N.*b.^2.*c.^2.*n.*cos(q).*cos(q1).*cos(q3).*sin(q3) - 2.*N.*b.^2.*c.^2.*n.*cos(q1).^2.*sin(q3).^2 - 2.*N.*b.^2.*c.^2.*n.*cos(q1).*sin(q).*sin(q1).*sin(q3).^2 + P.^2.*a.^2.*b.^2.*cos(q).^2.*sin(q3).^2 - 2.*P.^2.*a.^2.*b.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + P.^2.*a.^2.*b.^2.*cos(q3).^2.*sin(q).^2.*sin(q1).^2 + P.^2.*a.^2.*c.^2.*cos(q1).^2.*sin(q).^2 + P.^2.*b.^2.*c.^2.*cos(q).^2.*cos(q3).^2 + 2.*P.^2.*b.^2.*c.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + P.^2.*b.^2.*c.^2.*sin(q).^2.*sin(q1).^2.*sin(q3).^2 + 2.*P.*Q.*a.^2.*b.^2.*cos(q).^2.*sin(q3).^2 - 4.*P.*Q.*a.^2.*b.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + 2.*P.*Q.*a.^2.*b.^2.*cos(q3).^2.*sin(q).^2.*sin(q1).^2 + 2.*P.*Q.*a.^2.*c.^2.*cos(q1).^2.*sin(q).^2 + 2.*P.*Q.*b.^2.*c.^2.*cos(q).^2.*cos(q3).^2 + 4.*P.*Q.*b.^2.*c.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + 2.*P.*Q.*b.^2.*c.^2.*sin(q).^2.*sin(q1).^2.*sin(q3).^2 - 2.*P.*a.^2.*b.^2.*m.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) + 2.*P.*a.^2.*b.^2.*m.*cos(q).*cos(q3).^2.*sin(q).*sin(q1).^2 - 2.*P.*a.^2.*b.^2.*m.*cos(q).*sin(q).*sin(q3).^2 + 2.*P.*a.^2.*b.^2.*m.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*P.*a.^2.*b.^2.*n.*cos(q).^2.*sin(q3).^2 + 2.*P.*a.^2.*b.^2.*n.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 4.*P.*a.^2.*b.^2.*n.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) - 2.*P.*a.^2.*b.^2.*n.*cos(q1).*cos(q3).^2.*sin(q).*sin(q1) - 2.*P.*a.^2.*b.^2.*n.*cos(q3).^2.*sin(q).^2.*sin(q1).^2 + 2.*P.*a.^2.*c.^2.*m.*cos(q).*cos(q1).^2.*sin(q) - 2.*P.*a.^2.*c.^2.*n.*cos(q1).^2.*sin(q).^2 + 2.*P.*a.^2.*c.^2.*n.*cos(q1).*sin(q).*sin(q1) + 2.*P.*b.^2.*c.^2.*m.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) - 2.*P.*b.^2.*c.^2.*m.*cos(q).*cos(q3).^2.*sin(q) + 2.*P.*b.^2.*c.^2.*m.*cos(q).*sin(q).*sin(q1).^2.*sin(q3).^2 - 2.*P.*b.^2.*c.^2.*m.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*P.*b.^2.*c.^2.*n.*cos(q).^2.*cos(q3).^2 - 2.*P.*b.^2.*c.^2.*n.*cos(q).*cos(q1).*cos(q3).*sin(q3) - 4.*P.*b.^2.*c.^2.*n.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) - 2.*P.*b.^2.*c.^2.*n.*cos(q1).*sin(q).*sin(q1).*sin(q3).^2 - 2.*P.*b.^2.*c.^2.*n.*sin(q).^2.*sin(q1).^2.*sin(q3).^2 + Q.^2.*a.^2.*b.^2.*cos(q).^2.*sin(q3).^2 - 2.*Q.^2.*a.^2.*b.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + Q.^2.*a.^2.*b.^2.*cos(q3).^2.*sin(q).^2.*sin(q1).^2 + Q.^2.*a.^2.*c.^2.*cos(q1).^2.*sin(q).^2 + Q.^2.*b.^2.*c.^2.*cos(q).^2.*cos(q3).^2 + 2.*Q.^2.*b.^2.*c.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + Q.^2.*b.^2.*c.^2.*sin(q).^2.*sin(q1).^2.*sin(q3).^2 - 2.*Q.*a.^2.*b.^2.*m.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) + 2.*Q.*a.^2.*b.^2.*m.*cos(q).*cos(q3).^2.*sin(q).*sin(q1).^2 - 2.*Q.*a.^2.*b.^2.*m.*cos(q).*sin(q).*sin(q3).^2 + 2.*Q.*a.^2.*b.^2.*m.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*Q.*a.^2.*b.^2.*n.*cos(q).^2.*sin(q3).^2 + 2.*Q.*a.^2.*b.^2.*n.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 4.*Q.*a.^2.*b.^2.*n.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) - 2.*Q.*a.^2.*b.^2.*n.*cos(q1).*cos(q3).^2.*sin(q).*sin(q1) - 2.*Q.*a.^2.*b.^2.*n.*cos(q3).^2.*sin(q).^2.*sin(q1).^2 + 2.*Q.*a.^2.*c.^2.*m.*cos(q).*cos(q1).^2.*sin(q) - 2.*Q.*a.^2.*c.^2.*n.*cos(q1).^2.*sin(q).^2 + 2.*Q.*a.^2.*c.^2.*n.*cos(q1).*sin(q).*sin(q1) + 2.*Q.*b.^2.*c.^2.*m.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) - 2.*Q.*b.^2.*c.^2.*m.*cos(q).*cos(q3).^2.*sin(q) + 2.*Q.*b.^2.*c.^2.*m.*cos(q).*sin(q).*sin(q1).^2.*sin(q3).^2 - 2.*Q.*b.^2.*c.^2.*m.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*Q.*b.^2.*c.^2.*n.*cos(q).^2.*cos(q3).^2 - 2.*Q.*b.^2.*c.^2.*n.*cos(q).*cos(q1).*cos(q3).*sin(q3) - 4.*Q.*b.^2.*c.^2.*n.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) - 2.*Q.*b.^2.*c.^2.*n.*cos(q1).*sin(q).*sin(q1).*sin(q3).^2 - 2.*Q.*b.^2.*c.^2.*n.*sin(q).^2.*sin(q1).^2.*sin(q3).^2 + a.^2.*b.^2.*m.^2.*cos(q).^2.*cos(q3).^2.*sin(q1).^2 + 2.*a.^2.*b.^2.*m.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + a.^2.*b.^2.*m.^2.*sin(q).^2.*sin(q3).^2 + 2.*a.^2.*b.^2.*m.*n.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) - 2.*a.^2.*b.^2.*m.*n.*cos(q).*cos(q1).*cos(q3).^2.*sin(q1) - 2.*a.^2.*b.^2.*m.*n.*cos(q).*cos(q3).^2.*sin(q).*sin(q1).^2 + 2.*a.^2.*b.^2.*m.*n.*cos(q).*sin(q).*sin(q3).^2 - 2.*a.^2.*b.^2.*m.*n.*cos(q1).*cos(q3).*sin(q).*sin(q3) - 2.*a.^2.*b.^2.*m.*n.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) + a.^2.*b.^2.*n.^2.*cos(q).^2.*sin(q3).^2 - 2.*a.^2.*b.^2.*n.^2.*cos(q).*cos(q1).*cos(q3).*sin(q3) - 2.*a.^2.*b.^2.*n.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + a.^2.*b.^2.*n.^2.*cos(q1).^2.*cos(q3).^2 + 2.*a.^2.*b.^2.*n.^2.*cos(q1).*cos(q3).^2.*sin(q).*sin(q1) + a.^2.*b.^2.*n.^2.*cos(q3).^2.*sin(q).^2.*sin(q1).^2 + a.^2.*c.^2.*m.^2.*cos(q).^2.*cos(q1).^2 - 2.*a.^2.*c.^2.*m.*n.*cos(q).*cos(q1).^2.*sin(q) + 2.*a.^2.*c.^2.*m.*n.*cos(q).*cos(q1).*sin(q1) + a.^2.*c.^2.*n.^2.*cos(q1).^2.*sin(q).^2 - 2.*a.^2.*c.^2.*n.^2.*cos(q1).*sin(q).*sin(q1) + a.^2.*c.^2.*n.^2.*sin(q1).^2 + b.^2.*c.^2.*m.^2.*cos(q).^2.*sin(q1).^2.*sin(q3).^2 - 2.*b.^2.*c.^2.*m.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + b.^2.*c.^2.*m.^2.*cos(q3).^2.*sin(q).^2 - 2.*b.^2.*c.^2.*m.*n.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) - 2.*b.^2.*c.^2.*m.*n.*cos(q).*cos(q1).*sin(q1).*sin(q3).^2 + 2.*b.^2.*c.^2.*m.*n.*cos(q).*cos(q3).^2.*sin(q) - 2.*b.^2.*c.^2.*m.*n.*cos(q).*sin(q).*sin(q1).^2.*sin(q3).^2 + 2.*b.^2.*c.^2.*m.*n.*cos(q1).*cos(q3).*sin(q).*sin(q3) + 2.*b.^2.*c.^2.*m.*n.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) + b.^2.*c.^2.*n.^2.*cos(q).^2.*cos(q3).^2 + 2.*b.^2.*c.^2.*n.^2.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 2.*b.^2.*c.^2.*n.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + b.^2.*c.^2.*n.^2.*cos(q1).^2.*sin(q3).^2 + 2.*b.^2.*c.^2.*n.^2.*cos(q1).*sin(q).*sin(q1).*sin(q3).^2 + b.^2.*c.^2.*n.^2.*sin(q).^2.*sin(q1).^2.*sin(q3).^2).^2 - (a.^4.*b.^4.*c.^4.*(4.*((cos(q3).*(cos(q).*(P + Q - n) + sin(q).*(M - m)) + sin(q3).*(sin(q1).*(sin(q).*(P + Q - n) - cos(q).*(M - m)) + cos(q1).*(N - n))).^2./a.^2 + (sin(q3).*(cos(q).*(P + Q - n) + sin(q).*(M - m)) - cos(q3).*(sin(q1).*(sin(q).*(P + Q - n) - cos(q).*(M - m)) + cos(q1).*(N - n))).^2./c.^2 + (cos(q1).*(sin(q).*(P + Q - n) - cos(q).*(M - m)) - sin(q1).*(N - n)).^2./b.^2).*((cos(q3).*(n.*cos(q) - P.*cos(q) + m.*sin(q)) + sin(q3).*(n.*cos(q1) - P.*sin(q).*sin(q1) - m.*cos(q).*sin(q1) + n.*sin(q).*sin(q1))).^2./a.^2 + (sin(q3).*(n.*cos(q) - P.*cos(q) + m.*sin(q)) - cos(q3).*(n.*cos(q1) - P.*sin(q).*sin(q1) - m.*cos(q).*sin(q1) + n.*sin(q).*sin(q1))).^2./c.^2 + (n.*sin(q1) + P.*cos(q1).*sin(q) + m.*cos(q).*cos(q1) - n.*cos(q1).*sin(q)).^2./b.^2 - 1) - ((2.*(cos(q3).*(cos(q).*(P + Q - n) + sin(q).*(M - m)) + sin(q3).*(sin(q1).*(sin(q).*(P + Q - n) - cos(q).*(M - m)) + cos(q1).*(N - n))).*(cos(q3).*(n.*cos(q) - P.*cos(q) + m.*sin(q)) + sin(q3).*(n.*cos(q1) - P.*sin(q).*sin(q1) - m.*cos(q).*sin(q1) + n.*sin(q).*sin(q1))))./a.^2 - (2.*(cos(q1).*(sin(q).*(P + Q - n) - cos(q).*(M - m)) - sin(q1).*(N - n)).*(n.*sin(q1) + P.*cos(q1).*sin(q) + m.*cos(q).*cos(q1) - n.*cos(q1).*sin(q)))./b.^2 + (2.*(sin(q3).*(cos(q).*(P + Q - n) + sin(q).*(M - m)) - cos(q3).*(sin(q1).*(sin(q).*(P + Q - n) - cos(q).*(M - m)) + cos(q1).*(N - n))).*(sin(q3).*(n.*cos(q) - P.*cos(q) + m.*sin(q)) - cos(q3).*(n.*cos(q1) - P.*sin(q).*sin(q1) - m.*cos(q).*sin(q1) + n.*sin(q).*sin(q1))))./c.^2).^2).*(P + Q - n).^2)./(M.^2.*a.^2.*b.^2.*cos(q).^2.*cos(q3).^2.*sin(q1).^2 + 2.*M.^2.*a.^2.*b.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + M.^2.*a.^2.*b.^2.*sin(q).^2.*sin(q3).^2 + M.^2.*a.^2.*c.^2.*cos(q).^2.*cos(q1).^2 + M.^2.*b.^2.*c.^2.*cos(q).^2.*sin(q1).^2.*sin(q3).^2 - 2.*M.^2.*b.^2.*c.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + M.^2.*b.^2.*c.^2.*cos(q3).^2.*sin(q).^2 - 2.*M.*N.*a.^2.*b.^2.*cos(q).*cos(q1).*cos(q3).^2.*sin(q1) - 2.*M.*N.*a.^2.*b.^2.*cos(q1).*cos(q3).*sin(q).*sin(q3) + 2.*M.*N.*a.^2.*c.^2.*cos(q).*cos(q1).*sin(q1) - 2.*M.*N.*b.^2.*c.^2.*cos(q).*cos(q1).*sin(q1).*sin(q3).^2 + 2.*M.*N.*b.^2.*c.^2.*cos(q1).*cos(q3).*sin(q).*sin(q3) + 2.*M.*P.*a.^2.*b.^2.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) - 2.*M.*P.*a.^2.*b.^2.*cos(q).*cos(q3).^2.*sin(q).*sin(q1).^2 + 2.*M.*P.*a.^2.*b.^2.*cos(q).*sin(q).*sin(q3).^2 - 2.*M.*P.*a.^2.*b.^2.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*M.*P.*a.^2.*c.^2.*cos(q).*cos(q1).^2.*sin(q) - 2.*M.*P.*b.^2.*c.^2.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) + 2.*M.*P.*b.^2.*c.^2.*cos(q).*cos(q3).^2.*sin(q) - 2.*M.*P.*b.^2.*c.^2.*cos(q).*sin(q).*sin(q1).^2.*sin(q3).^2 + 2.*M.*P.*b.^2.*c.^2.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) + 2.*M.*Q.*a.^2.*b.^2.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) - 2.*M.*Q.*a.^2.*b.^2.*cos(q).*cos(q3).^2.*sin(q).*sin(q1).^2 + 2.*M.*Q.*a.^2.*b.^2.*cos(q).*sin(q).*sin(q3).^2 - 2.*M.*Q.*a.^2.*b.^2.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*M.*Q.*a.^2.*c.^2.*cos(q).*cos(q1).^2.*sin(q) - 2.*M.*Q.*b.^2.*c.^2.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) + 2.*M.*Q.*b.^2.*c.^2.*cos(q).*cos(q3).^2.*sin(q) - 2.*M.*Q.*b.^2.*c.^2.*cos(q).*sin(q).*sin(q1).^2.*sin(q3).^2 + 2.*M.*Q.*b.^2.*c.^2.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*M.*a.^2.*b.^2.*m.*cos(q).^2.*cos(q3).^2.*sin(q1).^2 - 4.*M.*a.^2.*b.^2.*m.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) - 2.*M.*a.^2.*b.^2.*m.*sin(q).^2.*sin(q3).^2 - 2.*M.*a.^2.*b.^2.*n.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) + 2.*M.*a.^2.*b.^2.*n.*cos(q).*cos(q1).*cos(q3).^2.*sin(q1) + 2.*M.*a.^2.*b.^2.*n.*cos(q).*cos(q3).^2.*sin(q).*sin(q1).^2 - 2.*M.*a.^2.*b.^2.*n.*cos(q).*sin(q).*sin(q3).^2 + 2.*M.*a.^2.*b.^2.*n.*cos(q1).*cos(q3).*sin(q).*sin(q3) + 2.*M.*a.^2.*b.^2.*n.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*M.*a.^2.*c.^2.*m.*cos(q).^2.*cos(q1).^2 + 2.*M.*a.^2.*c.^2.*n.*cos(q).*cos(q1).^2.*sin(q) - 2.*M.*a.^2.*c.^2.*n.*cos(q).*cos(q1).*sin(q1) - 2.*M.*b.^2.*c.^2.*m.*cos(q).^2.*sin(q1).^2.*sin(q3).^2 + 4.*M.*b.^2.*c.^2.*m.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) - 2.*M.*b.^2.*c.^2.*m.*cos(q3).^2.*sin(q).^2 + 2.*M.*b.^2.*c.^2.*n.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) + 2.*M.*b.^2.*c.^2.*n.*cos(q).*cos(q1).*sin(q1).*sin(q3).^2 - 2.*M.*b.^2.*c.^2.*n.*cos(q).*cos(q3).^2.*sin(q) + 2.*M.*b.^2.*c.^2.*n.*cos(q).*sin(q).*sin(q1).^2.*sin(q3).^2 - 2.*M.*b.^2.*c.^2.*n.*cos(q1).*cos(q3).*sin(q).*sin(q3) - 2.*M.*b.^2.*c.^2.*n.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) + N.^2.*a.^2.*b.^2.*cos(q1).^2.*cos(q3).^2 + N.^2.*a.^2.*c.^2.*sin(q1).^2 + N.^2.*b.^2.*c.^2.*cos(q1).^2.*sin(q3).^2 - 2.*N.*P.*a.^2.*b.^2.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 2.*N.*P.*a.^2.*b.^2.*cos(q1).*cos(q3).^2.*sin(q).*sin(q1) - 2.*N.*P.*a.^2.*c.^2.*cos(q1).*sin(q).*sin(q1) + 2.*N.*P.*b.^2.*c.^2.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 2.*N.*P.*b.^2.*c.^2.*cos(q1).*sin(q).*sin(q1).*sin(q3).^2 - 2.*N.*Q.*a.^2.*b.^2.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 2.*N.*Q.*a.^2.*b.^2.*cos(q1).*cos(q3).^2.*sin(q).*sin(q1) - 2.*N.*Q.*a.^2.*c.^2.*cos(q1).*sin(q).*sin(q1) + 2.*N.*Q.*b.^2.*c.^2.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 2.*N.*Q.*b.^2.*c.^2.*cos(q1).*sin(q).*sin(q1).*sin(q3).^2 + 2.*N.*a.^2.*b.^2.*m.*cos(q).*cos(q1).*cos(q3).^2.*sin(q1) + 2.*N.*a.^2.*b.^2.*m.*cos(q1).*cos(q3).*sin(q).*sin(q3) + 2.*N.*a.^2.*b.^2.*n.*cos(q).*cos(q1).*cos(q3).*sin(q3) - 2.*N.*a.^2.*b.^2.*n.*cos(q1).^2.*cos(q3).^2 - 2.*N.*a.^2.*b.^2.*n.*cos(q1).*cos(q3).^2.*sin(q).*sin(q1) - 2.*N.*a.^2.*c.^2.*m.*cos(q).*cos(q1).*sin(q1) + 2.*N.*a.^2.*c.^2.*n.*cos(q1).*sin(q).*sin(q1) - 2.*N.*a.^2.*c.^2.*n.*sin(q1).^2 + 2.*N.*b.^2.*c.^2.*m.*cos(q).*cos(q1).*sin(q1).*sin(q3).^2 - 2.*N.*b.^2.*c.^2.*m.*cos(q1).*cos(q3).*sin(q).*sin(q3) - 2.*N.*b.^2.*c.^2.*n.*cos(q).*cos(q1).*cos(q3).*sin(q3) - 2.*N.*b.^2.*c.^2.*n.*cos(q1).^2.*sin(q3).^2 - 2.*N.*b.^2.*c.^2.*n.*cos(q1).*sin(q).*sin(q1).*sin(q3).^2 + P.^2.*a.^2.*b.^2.*cos(q).^2.*sin(q3).^2 - 2.*P.^2.*a.^2.*b.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + P.^2.*a.^2.*b.^2.*cos(q3).^2.*sin(q).^2.*sin(q1).^2 + P.^2.*a.^2.*c.^2.*cos(q1).^2.*sin(q).^2 + P.^2.*b.^2.*c.^2.*cos(q).^2.*cos(q3).^2 + 2.*P.^2.*b.^2.*c.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + P.^2.*b.^2.*c.^2.*sin(q).^2.*sin(q1).^2.*sin(q3).^2 + 2.*P.*Q.*a.^2.*b.^2.*cos(q).^2.*sin(q3).^2 - 4.*P.*Q.*a.^2.*b.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + 2.*P.*Q.*a.^2.*b.^2.*cos(q3).^2.*sin(q).^2.*sin(q1).^2 + 2.*P.*Q.*a.^2.*c.^2.*cos(q1).^2.*sin(q).^2 + 2.*P.*Q.*b.^2.*c.^2.*cos(q).^2.*cos(q3).^2 + 4.*P.*Q.*b.^2.*c.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + 2.*P.*Q.*b.^2.*c.^2.*sin(q).^2.*sin(q1).^2.*sin(q3).^2 - 2.*P.*a.^2.*b.^2.*m.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) + 2.*P.*a.^2.*b.^2.*m.*cos(q).*cos(q3).^2.*sin(q).*sin(q1).^2 - 2.*P.*a.^2.*b.^2.*m.*cos(q).*sin(q).*sin(q3).^2 + 2.*P.*a.^2.*b.^2.*m.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*P.*a.^2.*b.^2.*n.*cos(q).^2.*sin(q3).^2 + 2.*P.*a.^2.*b.^2.*n.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 4.*P.*a.^2.*b.^2.*n.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) - 2.*P.*a.^2.*b.^2.*n.*cos(q1).*cos(q3).^2.*sin(q).*sin(q1) - 2.*P.*a.^2.*b.^2.*n.*cos(q3).^2.*sin(q).^2.*sin(q1).^2 + 2.*P.*a.^2.*c.^2.*m.*cos(q).*cos(q1).^2.*sin(q) - 2.*P.*a.^2.*c.^2.*n.*cos(q1).^2.*sin(q).^2 + 2.*P.*a.^2.*c.^2.*n.*cos(q1).*sin(q).*sin(q1) + 2.*P.*b.^2.*c.^2.*m.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) - 2.*P.*b.^2.*c.^2.*m.*cos(q).*cos(q3).^2.*sin(q) + 2.*P.*b.^2.*c.^2.*m.*cos(q).*sin(q).*sin(q1).^2.*sin(q3).^2 - 2.*P.*b.^2.*c.^2.*m.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*P.*b.^2.*c.^2.*n.*cos(q).^2.*cos(q3).^2 - 2.*P.*b.^2.*c.^2.*n.*cos(q).*cos(q1).*cos(q3).*sin(q3) - 4.*P.*b.^2.*c.^2.*n.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) - 2.*P.*b.^2.*c.^2.*n.*cos(q1).*sin(q).*sin(q1).*sin(q3).^2 - 2.*P.*b.^2.*c.^2.*n.*sin(q).^2.*sin(q1).^2.*sin(q3).^2 + Q.^2.*a.^2.*b.^2.*cos(q).^2.*sin(q3).^2 - 2.*Q.^2.*a.^2.*b.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + Q.^2.*a.^2.*b.^2.*cos(q3).^2.*sin(q).^2.*sin(q1).^2 + Q.^2.*a.^2.*c.^2.*cos(q1).^2.*sin(q).^2 + Q.^2.*b.^2.*c.^2.*cos(q).^2.*cos(q3).^2 + 2.*Q.^2.*b.^2.*c.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + Q.^2.*b.^2.*c.^2.*sin(q).^2.*sin(q1).^2.*sin(q3).^2 - 2.*Q.*a.^2.*b.^2.*m.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) + 2.*Q.*a.^2.*b.^2.*m.*cos(q).*cos(q3).^2.*sin(q).*sin(q1).^2 - 2.*Q.*a.^2.*b.^2.*m.*cos(q).*sin(q).*sin(q3).^2 + 2.*Q.*a.^2.*b.^2.*m.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*Q.*a.^2.*b.^2.*n.*cos(q).^2.*sin(q3).^2 + 2.*Q.*a.^2.*b.^2.*n.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 4.*Q.*a.^2.*b.^2.*n.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) - 2.*Q.*a.^2.*b.^2.*n.*cos(q1).*cos(q3).^2.*sin(q).*sin(q1) - 2.*Q.*a.^2.*b.^2.*n.*cos(q3).^2.*sin(q).^2.*sin(q1).^2 + 2.*Q.*a.^2.*c.^2.*m.*cos(q).*cos(q1).^2.*sin(q) - 2.*Q.*a.^2.*c.^2.*n.*cos(q1).^2.*sin(q).^2 + 2.*Q.*a.^2.*c.^2.*n.*cos(q1).*sin(q).*sin(q1) + 2.*Q.*b.^2.*c.^2.*m.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) - 2.*Q.*b.^2.*c.^2.*m.*cos(q).*cos(q3).^2.*sin(q) + 2.*Q.*b.^2.*c.^2.*m.*cos(q).*sin(q).*sin(q1).^2.*sin(q3).^2 - 2.*Q.*b.^2.*c.^2.*m.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) - 2.*Q.*b.^2.*c.^2.*n.*cos(q).^2.*cos(q3).^2 - 2.*Q.*b.^2.*c.^2.*n.*cos(q).*cos(q1).*cos(q3).*sin(q3) - 4.*Q.*b.^2.*c.^2.*n.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) - 2.*Q.*b.^2.*c.^2.*n.*cos(q1).*sin(q).*sin(q1).*sin(q3).^2 - 2.*Q.*b.^2.*c.^2.*n.*sin(q).^2.*sin(q1).^2.*sin(q3).^2 + a.^2.*b.^2.*m.^2.*cos(q).^2.*cos(q3).^2.*sin(q1).^2 + 2.*a.^2.*b.^2.*m.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + a.^2.*b.^2.*m.^2.*sin(q).^2.*sin(q3).^2 + 2.*a.^2.*b.^2.*m.*n.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) - 2.*a.^2.*b.^2.*m.*n.*cos(q).*cos(q1).*cos(q3).^2.*sin(q1) - 2.*a.^2.*b.^2.*m.*n.*cos(q).*cos(q3).^2.*sin(q).*sin(q1).^2 + 2.*a.^2.*b.^2.*m.*n.*cos(q).*sin(q).*sin(q3).^2 - 2.*a.^2.*b.^2.*m.*n.*cos(q1).*cos(q3).*sin(q).*sin(q3) - 2.*a.^2.*b.^2.*m.*n.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) + a.^2.*b.^2.*n.^2.*cos(q).^2.*sin(q3).^2 - 2.*a.^2.*b.^2.*n.^2.*cos(q).*cos(q1).*cos(q3).*sin(q3) - 2.*a.^2.*b.^2.*n.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + a.^2.*b.^2.*n.^2.*cos(q1).^2.*cos(q3).^2 + 2.*a.^2.*b.^2.*n.^2.*cos(q1).*cos(q3).^2.*sin(q).*sin(q1) + a.^2.*b.^2.*n.^2.*cos(q3).^2.*sin(q).^2.*sin(q1).^2 + a.^2.*c.^2.*m.^2.*cos(q).^2.*cos(q1).^2 - 2.*a.^2.*c.^2.*m.*n.*cos(q).*cos(q1).^2.*sin(q) + 2.*a.^2.*c.^2.*m.*n.*cos(q).*cos(q1).*sin(q1) + a.^2.*c.^2.*n.^2.*cos(q1).^2.*sin(q).^2 - 2.*a.^2.*c.^2.*n.^2.*cos(q1).*sin(q).*sin(q1) + a.^2.*c.^2.*n.^2.*sin(q1).^2 + b.^2.*c.^2.*m.^2.*cos(q).^2.*sin(q1).^2.*sin(q3).^2 - 2.*b.^2.*c.^2.*m.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + b.^2.*c.^2.*m.^2.*cos(q3).^2.*sin(q).^2 - 2.*b.^2.*c.^2.*m.*n.*cos(q).^2.*cos(q3).*sin(q1).*sin(q3) - 2.*b.^2.*c.^2.*m.*n.*cos(q).*cos(q1).*sin(q1).*sin(q3).^2 + 2.*b.^2.*c.^2.*m.*n.*cos(q).*cos(q3).^2.*sin(q) - 2.*b.^2.*c.^2.*m.*n.*cos(q).*sin(q).*sin(q1).^2.*sin(q3).^2 + 2.*b.^2.*c.^2.*m.*n.*cos(q1).*cos(q3).*sin(q).*sin(q3) + 2.*b.^2.*c.^2.*m.*n.*cos(q3).*sin(q).^2.*sin(q1).*sin(q3) + b.^2.*c.^2.*n.^2.*cos(q).^2.*cos(q3).^2 + 2.*b.^2.*c.^2.*n.^2.*cos(q).*cos(q1).*cos(q3).*sin(q3) + 2.*b.^2.*c.^2.*n.^2.*cos(q).*cos(q3).*sin(q).*sin(q1).*sin(q3) + b.^2.*c.^2.*n.^2.*cos(q1).^2.*sin(q3).^2 + 2.*b.^2.*c.^2.*n.^2.*cos(q1).*sin(q).*sin(q1).*sin(q3).^2 + b.^2.*c.^2.*n.^2.*sin(q).^2.*sin(q1).^2.*sin(q3).^2).^2; 

% l=gpuArray(l);
l(l<0)=0;
L=sqrt(l);
It = It+I0*(exp(-1*L/Lq));

 end
toc

end
%  disp(t);

    end
   pp=max(max(It));
 It=It/(nq)^2/nq1;
%  surf(N,M,It);
  mxm=min(It(:)); % определение максимального элемента

 SS=Lq*l./sqrt(((N.^2+M.^2)))
%  contourf(N,M,It, 100,'LineColor','none');
[row,col]=find(It==mxm);
M(row)
N(col)
figure(1);

colormap(jet)
shading interp 
 xlabel('M, мм');
 ylabel('N, мм');
 contourf(N,M,SS/2, 100,'LineColor','none')
%  zlabel('It, Вт/см^2');
 grid on
grid minor
hold on
toc